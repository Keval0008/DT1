@callback(
    Output('lineage-results', 'children'),
    [Input('trace-button', 'n_clicks')],
    [State('table-dropdown', 'value'),
     State('column-dropdown', 'value'),
     State('direction-radio', 'value')]
)
def update_lineage(n_clicks, tables, columns, direction):
    tracer = app.lineage_tracer  # Store tracer in app
    full_df, sources_df, dead_ends_df = tracer.trace_lineage(
        starting_tables=tables,
        starting_columns=columns,
        direction=direction
    )
    
    return html.Div([
        dcc.Markdown("### Full Lineage Trace"),
        dash_table.DataTable(full_df.to_dict('records')),
        
        dcc.Markdown("### Source Tables"),
        dash_table.DataTable(sources_df.to_dict('records')),
        
        dcc.Markdown("### Dead Ends"),
        dash_table.DataTable(dead_ends_df.to_dict('records'))
    ])
