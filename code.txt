import win32com.client
import pandas as pd

# Parameters
file_path = r"C:\path\to\your\file.xlsx"
password = "your_password"

# Initialize Excel
excel = win32com.client.Dispatch("Excel.Application")
excel.Visible = False

# Open workbook with password
workbook = excel.Workbooks.Open(file_path, False, True, None, password)

# Access sheet
sheet = workbook.Sheets(1)

# Get used range
used_range = sheet.UsedRange
nrows = used_range.Rows.Count
ncols = used_range.Columns.Count

# Extract data into nested list
data = []
for row in range(1, nrows + 1):
    row_data = []
    for col in range(1, ncols + 1):
        value = sheet.Cells(row, col).Value
        row_data.append(value)
    data.append(row_data)

# Convert to DataFrame
df = pd.DataFrame(data)

# Optionally set first row as header if applicable
df.columns = df.iloc[0]
df = df[1:].reset_index(drop=True)

# Close workbook and quit Excel
workbook.Close(False)
excel.Quit()

# Display
print(df.head())
